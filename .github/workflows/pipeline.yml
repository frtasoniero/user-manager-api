name: Build & Release
run-name: Building User Management API ðŸš€

on:
  push:
    branches: [ main ]

env:
  GO_VERSION: '1.25.0'

jobs:
  build-and-release:
    name: ðŸ”¨ Build & Release
    runs-on: ubuntu-latest
    
    permissions:
      contents: write

    steps:
    - name: ðŸ” Checkout code
      uses: actions/checkout@v5
      with:
        fetch-depth: 0

    - name: ðŸ¹ Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: ${{ env.GO_VERSION }}

    - name: ðŸ”¨ Build binaries
      run: |
        mkdir -p bin
        
        # Linux
        GOOS=linux GOARCH=amd64 go build -o bin/user-management-api-linux ./cmd/api
        
    - name: ðŸ·ï¸ Generate version
      id: version
      run: |
        VERSION="v$(date +'%Y.%m.%d')-${GITHUB_RUN_NUMBER}"
        echo "tag=${VERSION}" >> $GITHUB_OUTPUT

    - name: ðŸŽ‰ Create Release
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ steps.version.outputs.tag }}
        name: Release ${{ steps.version.outputs.tag }}
        body: |
          ## ðŸš€ User Management API - ${{ steps.version.outputs.tag }}
          
          **Download the binary for your platform:**
          - Linux: `user-management-api-linux`
        artifacts: "bin/*"
        token: ${{ secrets.GITHUB_TOKEN }}